- hosts: localhost
  tasks:
  - name: "Gather info"
    k8s_facts:
      kind: Service
      name: mexprometheusappnamev10-prometheus-node-exporter
      namespace: default
    register: alertmanager_facts
    retries: 24
    delay: 5
    until: alertmanager_facts.resources[0].spec.clusterIP is defined

  - name: "Set alertmanager API IP"
    set_fact:
      alertmanager_ip: "{{ alertmanager_facts.resources[0].spec.clusterIP }}"

  - name: "Set alertmanager API Port"
    set_fact:
      alertmanager_port: "{{ alertmanager_facts.resources[0].spec.ports[0].port }}"

  - name: "Set alertmanager API Address"
    set_fact:
      alertmanager_addr: "http://{{ alertmanager_ip }}:{{ alertmanager_port }}"

  - debug:
      msg: "Service facts '{{ alertmanager_facts }}'"
  
  - debug:
      msg: "Service Addr '{{ alertmanager_addr }}'"
###

# TODO -provision volume for alertmanager receivers
