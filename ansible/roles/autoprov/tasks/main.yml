- name: Fetch autoprov vault role
  set_fact:
    autoprov_role: "{{ lookup('approle', autoprov_role_name) }}"
  vars:
    autoprov_role_name: "{{ region | lower }}.autoprov.v1"

- name: Deploy Autoprov Service
  k8s:
    kubeconfig: "{{ kubeconfig_file.path }}"
    namespace: default
    state: present
    definition: "{{ lookup('template', 'deploy.yml.j2') }}"
