---
- name: Load reCAPTCHA key
  import_role:
    name: load-vault-creds
    tasks_from: recaptcha

- name: Deploy the console
  docker_container:
    name: "console-{{ deploy_environ }}"
    image: "{% if console_prod|bool %}{{ console_prod_image }}{% else %}{{ console_image }}{% endif %}:{{ console_version }}"
    restart_policy: unless-stopped
    ports:
      - "127.0.0.1:3000:{% if console_prod|bool %}80{% else %}3000{% endif %}"
    env:
      REACT_APP_API_ENDPOINT: "https://{{ inventory_hostname }}"
      REACT_APP_API_VM_ENDPOINT: "https://{{ console_vnc_hostname }}"
      REACT_APP_API_USE_SERVER_SUFFIX: "true"
      REACT_APP_CAPTCHA_V2_KEY: "{{ recaptcha_site_key }}"
