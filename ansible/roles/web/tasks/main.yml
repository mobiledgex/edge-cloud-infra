- name: Install Nginx
  package:
    name: nginx
    state: present
  become: yes

- name: Install Nginx Config
  template:
    src: "{{ nginx_config_template }}"
    dest: /etc/nginx/sites-available/default
    mode: 0644
  become: yes
  register: nginx_config
  when: nginx_config_template is defined

- import_tasks: certs.yml
  when: cert_domains

- name: Restart Nginx
  service:
    name: nginx
    state: restarted
  become: yes
  when: nginx_config.changed

- name: Ensure Nginx is running
  service:
    name: nginx
    state: started
  become: yes
