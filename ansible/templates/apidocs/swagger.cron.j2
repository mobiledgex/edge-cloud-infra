#!/bin/bash

DOCDIR='/var/swagger'
TAG=$( date +'%Y-%m-%d' )
EDGECLOUD="registry.mobiledgex.net:5000/mobiledgex/edge-cloud:$TAG"
APIDOCS_SAMPLES="{{ apidocs_samples_script }}"

sudo docker run --rm "$EDGECLOUD" version >/dev/null
if [[ $? -ne 0 ]]; then
	echo "Docker build not found: $EDGECLOUD" >&2
	exit 2
fi

download_doc() {
	local doctype="$1"
	local output="$2"
	[[ -z "$output" ]] && output="$doctype"
	sudo docker run --rm "$EDGECLOUD" dump-docs "$doctype" \
		| sed "s/\"version not set\"/\"${TAG}\"/" >"${DOCDIR}/${output}.swagger.json"
}

download_doc external
download_doc internal
download_doc client client-orig

${APIDOCS_SAMPLES} "${DOCDIR}/client-orig.swagger.json" "${DOCDIR}/client.swagger.json"
