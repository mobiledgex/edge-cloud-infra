filebeat.inputs:

- type: log
  enabled: true
  paths:
    - /var/log/vault_audit.log*
  exclude_files: ['.gz$']
  json.keys_under_root: true
  json.overwrite_keys: true
  fields:
    type: audit
  fields_under_root: true

# ======================= Elasticsearch template setting =======================

setup.template.settings:
  index.number_of_shards: 2


# ================================== General ===================================

tags: ["vault"]

fields:
  env: {{ deploy_environ }}

# =================================== Kibana ===================================

setup.kibana:

  # Kibana Host
  # Scheme and port can be left out and will be set to the default (http and 5601)
  # In case you specify and additional path, the scheme is required: http://localhost:5601/path
  # IPv6 addresses should always be defined as: https://[2001:db8::1]:5601
  #host: "localhost:5601"

  # Kibana Space ID
  # ID of the Kibana Space into which the dashboards should be loaded. By default,
  # the Default Space will be used.
  #space.id:

# =============================== Elastic Cloud ================================

# These settings simplify using Filebeat with the Elastic Cloud (https://cloud.elastic.co/).

# The cloud.id setting overwrites the `output.elasticsearch.hosts` and
# `setup.kibana.host` options.
# You can find the `cloud.id` in the Elastic Cloud web UI.
cloud.id: {{ elastic_cloud_id }}

# The cloud.auth setting overwrites the `output.elasticsearch.username` and
# `output.elasticsearch.password` settings. The format is `<user>:<pass>`.
cloud.auth: {{ elastic_cloud_auth }}

# ================================== Outputs ===================================

# Configure what output to use when sending the data collected by the beat.

# ---------------------------- Elasticsearch Output ----------------------------
output.elasticsearch:
  index: "vault-%{+yyyy.MM.dd}"

# ================================= Processors =================================

# Configure processors to enhance or manipulate events generated by the beat.

processors:
  - add_host_metadata: ~
  - timestamp:
      field: time
      layouts:
        - '2006-01-02T15:04:05.999999999Z'
      test:
        - '2020-06-30T16:45:20.802430401Z'
  - rename:
      fields:
        - from: error
          to: vault_error
  - drop_fields:
      fields: [time]

setup.template.overwrite: true
setup.template.name: "vault"
setup.template.pattern: "vault-*"
setup.template.fields: "{{ fields_path }}"

setup.ilm.enabled: auto
setup.ilm.rollover_alias: "vault"
setup.ilm.pattern: "{now/d}-000001"
