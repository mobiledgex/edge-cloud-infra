
heat_template_version: 2016-10-14
description: Create a VM
resources:

  

   vm_security_group:
       type: OS::Neutron::SecurityGroup
       properties:
          name: jlmcloudlet.tdg.mobiledgex.net-sg
          rules:
        
          - direction: egress
        
        

   jlmcloudlet.tdg.mobiledgex.net:
      type: OS::Nova::Server
      properties:
         name: jlmcloudlet.tdg.mobiledgex.net
       
       
         image: mobiledgex-v3.0.3
        
         security_groups:
           - { get_resource: vm_security_group }
          
           - 342f6bc4-49ac-4929-9cfb-5c5a5dc4386a
         flavor: m4.medium

        
         config_drive: true       
         user_data_format: RAW
         networks:
        
          - network: external-network-shared
        
         metadata:
            skipk8s: yes
            role: mex-agent-node 
            edgeproxy: 37.50.200.1
            mex-flavor: m4.medium
           
        
         user_data: |
            #cloud-config
            bootcmd:
             - echo MOBILEDGEX CLOUD CONFIG START
             - echo 'APT::Periodic::Enable "0";' > /etc/apt/apt.conf.d/10cloudinit-disable
             - apt-get -y purge update-notifier-common ubuntu-release-upgrader-core landscape-common unattended-upgrades
             - echo "Removed APT and Ubuntu extra packages" | systemd-cat
            ssh_authorized_keys:
             - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCrHlOJOJUqvd4nEOXQbdL8ODKzWaUxKVY94pF7J3diTxgZ1NTvS6omqOjRS3loiU7TOlQQU4cKnRRnmJW8QQQZSOMIGNrMMInGaEYsdm6+tr1k4DDfoOrkGMj3X/I2zXZ3U+pDPearVFbczCByPU0dqs16TWikxDoCCxJRGeeUl7duzD9a65bI8Jl+zpfQV+I7OPa81P5/fw15lTzT4+F9MhhOUVJ4PFfD+d6/BLnlUfZ94nZlvSYnT+GoZ8xTAstM7+6pvvvHtaHoV4YqRf5CelbWAQ162XNa9/pW5v/RKDrt203/JEk3e70tzx9KAfSw2vuO1QepkCZAdM9rQoCd ubuntu@registry
            chpasswd: { expire: False }
            ssh_pwauth: False
            timezone: UTC
            runcmd:
             - [ echo, MOBILEDGEX, doing, ifconfig ]
             - [ ifconfig, -a ]
        
        
  
  